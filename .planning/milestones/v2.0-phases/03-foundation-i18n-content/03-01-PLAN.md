---
phase: 03-foundation-i18n-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/global.css
  - astro.config.mjs
  - src/i18n/ui.ts
  - src/i18n/utils.ts
autonomous: true
requirements:
  - I18N-01
  - I18N-02

must_haves:
  truths:
    - "All color values in stylesheets use CSS custom properties (no hardcoded hex/rgb except in :root definitions)"
    - "Astro i18n config recognizes Italian as default locale at / and English at /en/"
    - "Translation dictionary contains all content strings for both IT and EN locales"
    - "Helper functions getLangFromUrl() and useTranslations() are available for page components"
  artifacts:
    - path: "src/styles/global.css"
      provides: "CSS custom properties including --color-border"
      contains: "--color-border"
    - path: "astro.config.mjs"
      provides: "Astro i18n routing configuration"
      contains: "defaultLocale"
    - path: "src/i18n/ui.ts"
      provides: "Translation strings dictionary for IT and EN"
      exports: ["languages", "defaultLang", "ui"]
    - path: "src/i18n/utils.ts"
      provides: "Locale detection and translation lookup helpers"
      exports: ["getLangFromUrl", "useTranslations"]
  key_links:
    - from: "src/i18n/utils.ts"
      to: "src/i18n/ui.ts"
      via: "import { ui, defaultLang }"
      pattern: "import.*ui.*from.*ui"
    - from: "astro.config.mjs"
      to: "i18n routing"
      via: "i18n config block"
      pattern: "defaultLocale.*it"
---

<objective>
Extract the last hardcoded CSS color into a custom property, configure Astro's built-in i18n routing, and create the translation dictionary with helper utilities.

Purpose: Lay the foundation that both locale pages depend on -- CSS variables ready for dark mode (Phase 4) and i18n infrastructure for the Italian/English pages.
Output: Refactored global.css, astro.config.mjs with i18n, src/i18n/ui.ts with all strings, src/i18n/utils.ts with helpers.
</objective>

<execution_context>
@/home/toto/.claude/get-shit-done/workflows/execute-plan.md
@/home/toto/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-foundation-i18n-content/03-RESEARCH.md
@src/styles/global.css
@src/pages/index.astro
@astro.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: CSS variable refactor and Astro i18n config</name>
  <files>src/styles/global.css, astro.config.mjs</files>
  <action>
**CSS refactor (global.css):**
1. Add `--color-border: #e0e0e0;` to the `:root` block, in the Colors section after `--color-link-hover`
2. Update the `hr` rule: change `border-top: 1px solid #e0e0e0` to `border-top: 1px solid var(--color-border)`
3. Update the Colors comment from `/* Colors (minimal white design) */` to `/* Colors (semantic names — ready for dark mode override) */`
4. No other changes — existing variables already use semantic naming per user decision

**Astro i18n config (astro.config.mjs):**
Add the `i18n` configuration block to `defineConfig`:
```js
i18n: {
  defaultLocale: 'it',
  locales: ['it', 'en'],
  routing: {
    prefixDefaultLocale: false,
  },
},
```
This keeps Italian at `/` (no prefix) per I18N-02 and enables English at `/en/` per I18N-01.

**Verification audit:** After changes, run `grep -rn '#[0-9a-fA-F]' src/` to confirm no hardcoded hex colors remain outside of `:root` variable definitions. The Section.astro component uses only spacing (no colors) so it should be clean.
  </action>
  <verify>
1. `grep -c 'color-border' src/styles/global.css` returns 2 (one definition, one usage)
2. `grep '#e0e0e0' src/styles/global.css` returns only the `:root` definition line
3. `grep 'defaultLocale' astro.config.mjs` returns the i18n config line
4. `npm run build` succeeds with no errors
  </verify>
  <done>
Every color value in stylesheets uses a CSS custom property (no hardcoded hex outside :root). Astro config has i18n routing with Italian as default locale (no prefix) and English at /en/.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create i18n translation dictionary and utility helpers</name>
  <files>src/i18n/ui.ts, src/i18n/utils.ts</files>
  <action>
**Create `src/i18n/ui.ts`:**
Export three things: `languages`, `defaultLang`, and `ui`.

The `ui` object must contain ALL content strings from `src/pages/index.astro` for both locales. Extract every piece of visible text from the current Italian page into translation keys.

Key naming convention: dot-separated hierarchy (`site.title`, `section.entrepreneurship.p1`, etc.)

Italian strings — copy exactly from current `index.astro`:
- `site.title`: 'Antonio Castaldi'
- `site.description`: 'Pagina personale di Antonio Castaldi — Imprenditore, informatico, personal trainer.'
- `intro.text`: 'Mi chiamo Antonio Castaldi ma tutti mi chiamano <em>Toto</em>, fallo anche tu :)'
- `intro.sections`: 'Ecco qualche parte di me :'
- `section.entrepreneurship.title`: 'Imprenditoria'
- `section.entrepreneurship.p1`: Full paragraph with Skillbill link (preserve HTML)
- `section.entrepreneurship.p2`: Full paragraph about work values
- `section.cs.title`: 'Informatica'
- `section.cs.p1`: Full paragraph about staying updated
- `section.cs.p2`: Full paragraph with GitHub and toto-castaldi.com links (preserve HTML)
- `section.fitness.title`: 'Fitness'
- `section.fitness.p1`: Full paragraph about training
- `section.fitness.p2`: Full paragraph about Personal Trainer work
- `section.cnv.title`: 'Comunicazione Non Violenta'
- `section.cnv.p1`: Full paragraph about Marshall Rosenberg (preserve HTML)
- `footer.contact`: 'Mi puoi contattare scrivendomi alla mail'
- `footer.noai`: 'scritto senza AI'

English strings — Claude drafts professional translations per user decisions:
- Professional tone matching Italian version (no informal shift)
- Natural English equivalents for section titles (not literal translations)
- Name stays "Antonio Castaldi" / "Toto" in both languages
- External links kept as original URLs (no swapping to English equivalents)
- CNV translated as-is, no extra context for international audience
- All HTML tags (`<a>`, `<em>`) preserved in translated strings

Use `as const` assertion on the `ui` object for TypeScript type safety.

**Create `src/i18n/utils.ts`:**
Two exported functions following the Astro i18n recipe pattern:

1. `getLangFromUrl(url: URL)` — extracts locale from URL pathname by splitting on '/' and checking if second segment is a valid locale key in `ui`. Returns `defaultLang` if not found.

2. `useTranslations(lang: keyof typeof ui)` — returns a function `t(key)` that looks up the translation for the given lang, falling back to `defaultLang` if the key is missing.

Import `ui` and `defaultLang` from `./ui`.
  </action>
  <verify>
1. `ls src/i18n/ui.ts src/i18n/utils.ts` — both files exist
2. `grep -c "as const" src/i18n/ui.ts` returns at least 1
3. `grep "getLangFromUrl" src/i18n/utils.ts` — function exported
4. `grep "useTranslations" src/i18n/utils.ts` — function exported
5. `npm run build` succeeds (TypeScript compiles without errors)
  </verify>
  <done>
Translation dictionary contains all content strings for both IT and EN locales with `as const` type safety. Helper functions `getLangFromUrl()` and `useTranslations()` are exported and ready for use by page components.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with zero errors
2. `grep -rn '#[0-9a-fA-F]' src/ --include='*.css' --include='*.astro'` shows hex values only in `:root` variable definitions
3. `grep 'defaultLocale' astro.config.mjs` confirms i18n config present
4. Both `src/i18n/ui.ts` and `src/i18n/utils.ts` exist and export the expected symbols
5. Italian content strings in `ui.ts` match the current `index.astro` content exactly
</verification>

<success_criteria>
- CSS has --color-border variable and no hardcoded colors outside :root
- astro.config.mjs has i18n routing with it as default (no prefix) and en as secondary locale
- ui.ts exports languages, defaultLang, and ui with all content strings for both locales
- utils.ts exports getLangFromUrl and useTranslations helper functions
- npm run build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/03-foundation-i18n-content/03-01-SUMMARY.md`
</output>
